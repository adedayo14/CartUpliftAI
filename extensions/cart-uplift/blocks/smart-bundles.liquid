{% comment %}
  Cart Uplift - Product Bundle Block  
  Version: 3.2.0 - Display style in theme schema
{% endcomment %}

{%- comment -%} Load CSS and JS assets with cache busting {%- endcomment -%}
<link rel="stylesheet" href="{{ 'cart-bundles.css' | asset_url }}?v={{ 'now' | date: '%s' }}">
<script src="{{ 'cart-bundles.js' | asset_url }}?v={{ 'now' | date: '%s' }}" defer></script>

{%- liquid
  assign bundle_enabled = block.settings.bundle_enabled
  assign display_style = block.settings.display_style
-%}

{% if bundle_enabled %}
  <div 
    class="cartuplift-bundle-wrapper"
    data-bundle-widget="true"
    data-product-id="{% if product %}{{ product.id }}{% endif %}"
    data-bundle-title="{{ block.settings.bundle_title | escape }}"
    data-bundle-priority="{{ block.settings.priority }}"
    data-display-style="{{ display_style }}"
    style="opacity: 0; transition: opacity 0.3s;"
  >
    <div class="cartuplift-bundle-loading" style="padding: 20px; text-align: center; color: #666;">
      <p style="margin: 0;">🎁 Loading bundles...</p>
    </div>
  </div>
  
  {%- comment -%} Show widget once CSS loaded {%- endcomment -%}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const widget = document.querySelector('[data-bundle-widget]');
      if (widget) {
        widget.style.opacity = '1';
      }
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "🎁 Smart Bundles",
  "target": "section",
  "templates": ["product", "collection"],
  "settings": [
    {
      "type": "paragraph",
      "content": "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n📦 **CREATE BUNDLES** in CartUplift admin dashboard, then **STYLE THEM HERE**.\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    },
    {
      "type": "checkbox",
      "id": "bundle_enabled",
      "label": "✅ Enable bundles on this page",
      "default": true,
      "info": "Toggle to show/hide bundle recommendations"
    },
    {
      "type": "text",
      "id": "bundle_title",
      "label": "📝 Section heading",
      "default": "Bundle & Save",
      "info": "Heading that appears above your bundles (optional)"
    },
    {
      "type": "header",
      "content": "🎨 Display Style"
    },
    {
      "type": "select",
      "id": "display_style",
      "label": "Choose your layout",
      "options": [
        {
          "value": "clean",
          "label": "🏆 Amazon Style (Recommended) - Horizontal row with summary"
        },
        {
          "value": "grid",
          "label": "☑️  Grid Layout - Cards with checkboxes for selection"
        },
        {
          "value": "list",
          "label": "📋 Compact List - Simple vertical layout"
        },
        {
          "value": "detailed",
          "label": "🔍 Detailed View - Full product info with variants"
        },
        {
          "value": "tier",
          "label": "📊 Quantity Tiers - Volume discounts (3 for $30, etc)"
        }
      ],
      "default": "clean",
      "info": "Amazon = Best for upsells | Grid = Interactive | List = Minimal | Detailed = Full info | Tier = Volume pricing"
    },
    {
      "type": "range",
      "id": "priority",
      "label": "⚡ Display priority",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 5,
      "info": "Order if multiple bundle blocks exist (1 = shows first)"
    },
    {
      "type": "paragraph",
      "content": "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n💡 **TO PREVIEW:** Click Save → View product page with bundles. Change styles anytime!\n\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
    }
  ]
}
{% endschema %}
/* Schema updated Mon Oct 20 17:02:01 BST 2025 */
