{% comment %}
  Cart Uplift - Product Bundle Block
  NOTE: Theme app extension blocks limited to 6 settings max
  Full bundle config managed in backend, block just triggers display
  Version: 1.0.0
{% endcomment %}

<script src="{{ 'cart-bundles.js' | asset_url }}" defer></script>

{%- liquid
  # Simple block - just displays bundles managed in backend
  assign bundle_enabled = block.settings.bundle_enabled
  
  unless bundle_enabled
    comment
      Bundle display disabled
    endcomment
  endunless
-%}

{% if bundle_enabled %}
  <div 
    class="cartuplift-bundle-wrapper"
    data-bundle-widget="true"
    data-product-id="{% if product %}{{ product.id }}{% endif %}"
    data-bundle-title="{{ block.settings.bundle_title | escape }}"
    data-bundle-priority="{{ block.settings.priority }}"
  >
    {%- comment -%} JavaScript will load bundles from backend API based on product ID {%- endcomment -%}
    <div class="cartuplift-bundle-loading" style="padding: 20px; text-align: center; color: #666;">
      <p style="margin: 0 0 8px 0;">üéÅ Loading bundles for product {{ product.id }}...</p>
      <p style="margin: 0; font-size: 12px; color: #999;">Check browser console (F12) for details</p>
    </div>
  </div>
{% endif %}

{% schema %}
{
  "name": "Smart Bundles",
  "target": "section",
  "templates": ["product", "collection"],
  "settings": [
    {
      "type": "paragraph",
      "content": "‚öôÔ∏è **Configure bundles in your Cart Uplift admin dashboard.** This block displays bundles you've created for each product. Bundle display styles (Grid, FBT, List, Carousel, Tier) are managed in the admin app, not here."
    },
    {
      "type": "checkbox",
      "id": "bundle_enabled",
      "label": "Enable bundles",
      "default": true,
      "info": "Show product bundles on this page"
    },
    {
      "type": "text",
      "id": "bundle_title",
      "label": "Section heading",
      "default": "Bundle & Save",
      "info": "Optional heading above bundles"
    },
    {
      "type": "range",
      "id": "priority",
      "label": "Display priority",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 5,
      "info": "Order if multiple bundle blocks on same page (1 = highest)"
    },
    {
      "type": "paragraph",
      "content": "üí° **To see bundles preview:** Visit a product page in your store where you've assigned bundles. The JavaScript will load and display bundles based on your admin configuration."
    }
  ]
}
{% endschema %}
